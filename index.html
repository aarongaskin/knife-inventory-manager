<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="-1">
    <title>Knife Inventory Manager - Properly Fixed</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .nav-tabs { display: flex; flex-wrap: wrap; background: #f8f9fa; border-bottom: 2px solid #e0e0e0; overflow-x: auto; }
        .nav-tabs button { background: none; border: none; padding: 15px 20px; font-size: 14px; font-weight: 500; cursor: pointer; color: #666; transition: all 0.3s ease; border-bottom: 3px solid transparent; white-space: nowrap; }
        .nav-tabs button:hover { background: #e8e8e8; color: #667eea; }
        .nav-tabs button.active { color: #667eea; border-bottom-color: #667eea; }
        .tab-content { padding: 30px; display: none; }
        .tab-content.active { display: block; }
        .tab-section h2 { color: #333; margin-bottom: 20px; font-size: 1.8em; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .sheet-controls { background: #f0f4ff; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 20px; flex-wrap: wrap; align-items: center; }
        .sheet-status { display: inline-flex; align-items: center; gap: 8px; padding: 12px 15px; border-radius: 6px; font-weight: 500; }
        .sheet-status.inactive { background: #f5f5f5; color: #666; }
        .sheet-status.active { background: #c8e6c9; color: #2e7d32; }
        .sheet-status.locked { background: #bbdefb; color: #1565c0; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        thead { background: #667eea; color: white; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        th { font-weight: 600; }
        tbody tr:hover { background: #f8f9fa; }
        input { width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 5px rgba(102, 126, 234, 0.3); }
        input[readonly] { background-color: #f8f9fa; color: #666; cursor: not-allowed; }
        .revenue-row { font-weight: 700; background: #fffacd; border-top: 2px solid #667eea; }
        .units-sold-row { font-weight: 700; background: #e8f5e9; }
        .nav-link { display: inline-block; margin-right: 10px; margin-bottom: 10px; padding: 10px 15px; background: white; border: 2px solid #667eea; color: #667eea; border-radius: 5px; cursor: pointer; font-weight: 500; transition: all 0.3s ease; }
        .nav-link:hover { background: #667eea; color: white; }
        .btn-lock { background: #ff9800 !important; color: white !important; border-color: #ff9800 !important; }
        .btn-lock:hover { background: #f57c00 !important; }
        .btn-unlock { background: #d32f2f !important; color: white !important; border-color: #d32f2f !important; }
        .btn-unlock:hover { background: #b71c1c !important; }
        .btn-activate { background: #4caf50 !important; color: white !important; border-color: #4caf50 !important; }
        .btn-activate:hover { background: #388e3c !important; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); max-width: 600px; width: 90%; }
        .modal-content h3 { margin-bottom: 20px; color: #333; }
        .modal-content p { margin-bottom: 15px; color: #666; }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        .modal-buttons button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: 500; }
        .btn-cancel { background: #e0e0e0; color: #333; }
        .btn-cancel:hover { background: #d0d0d0; }
        .btn-confirm { background: #667eea; color: white; }
        .btn-confirm:hover { background: #5568d3; }
        .status-box { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; }
        .status-success { background: #e8f5e9; color: #2e7d32; border-left: 4px solid #4caf50; }
        .status-error { background: #ffebee; color: #c62828; border-left: 4px solid #f44336; }
        .status-info { background: #e3f2fd; color: #1565c0; border-left: 4px solid #2196f3; }
        .modal-info { background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #4caf50; font-size: 13px; color: #2e7d32; }
        .modal-totals { background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .modal-totals tr { border-bottom: 1px solid #ddd; }
        .modal-totals td { padding: 8px; }
        .modal-totals td:last-child { text-align: right; font-weight: 600; }
        .inventory-controls { background: #e8f5e9; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .inventory-controls h3 { width: 100%; color: #2e7d32; margin-bottom: 15px; }
        .nav-links { margin-bottom: 20px; }
        @media (max-width: 768px) {
            .nav-tabs button { padding: 12px 15px; font-size: 12px; }
            .sheet-controls { flex-direction: column; align-items: flex-start; }
        }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, onValue, set, update } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDkDC2tBw5kswXpN5Cbnr39kbLhcLGxK8I",
            authDomain: "knife-inventory-management.firebaseapp.com",
            databaseURL: "https://knife-inventory-management-default-rtdb.firebaseio.com",
            projectId: "knife-inventory-management",
            storageBucket: "knife-inventory-management.firebasestorage.app",
            messagingSenderId: "944440388498",
            appId: "1:944440388498:web:8eadb87306507966f1af4b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Make Firebase functions globally available
        window.firebaseDB = db;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseUpdate = update;
        window.firebaseOnValue = onValue;
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Knife Inventory Manager</h1>
            <p>Activate Sheet ‚Üí Fill Units Left ‚Üí Lock Event ‚Üí Data Saved to Firebase</p>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab(event, 'pop-nav')">Pop's Sheets</button>
            <button class="tab-btn" onclick="switchTab(event, 'pop-inv')">Pop Inventory</button>
            <button class="tab-btn" onclick="switchTab(event, 'wetumpka')">Wetumpka</button>
            <button class="tab-btn" onclick="switchTab(event, 'trussville')">Trussville</button>
            <button class="tab-btn" onclick="switchTab(event, 'columbia')">Columbia</button>
            <button class="tab-btn" onclick="switchTab(event, 'hattiesburg')">Hattiesburg</button>
        </div>

        <!-- Pop Navigation -->
        <div id="pop-nav" class="tab-content active">
            <div class="tab-section">
                <h2>Pop's Sales Sheets</h2>
                <div class="nav-links">
                    <button class="nav-link" onclick="switchTab(event, 'pop-inv')">üì¶ Pop Inventory</button>
                    <button class="nav-link btn-activate" onclick="switchTab(event, 'wetumpka')">Wetumpka</button>
                    <button class="nav-link btn-activate" onclick="switchTab(event, 'trussville')">Trussville</button>
                    <button class="nav-link btn-activate" onclick="switchTab(event, 'columbia')">Columbia</button>
                    <button class="nav-link btn-activate" onclick="switchTab(event, 'hattiesburg')">Hattiesburg</button>
                </div>
            </div>
        </div>

        <!-- Pop Inventory -->
        <div id="pop-inv" class="tab-content">
            <div class="tab-section">
                <h2>Pop's Current Inventory</h2>
                <table>
                    <thead>
                        <tr><th>Product</th><th>Price</th><th>Storage</th><th>Show Tub</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Full Tang</td><td><input type="number" class="pop-price" data-idx="0"></td><td><input type="number" value="314" class="pop-storage" data-idx="0" readonly></td><td><input type="number" class="pop-show" data-idx="0"></td></tr>
                        <tr><td>8" Rat</td><td><input type="number" class="pop-price" data-idx="1"></td><td><input type="number" value="112" class="pop-storage" data-idx="1" readonly></td><td><input type="number" class="pop-show" data-idx="1"></td></tr>
                        <tr><td>6" Rat</td><td><input type="number" class="pop-price" data-idx="2"></td><td><input type="number" value="164" class="pop-storage" data-idx="2" readonly></td><td><input type="number" class="pop-show" data-idx="2"></td></tr>
                        <tr><td>8" Stag</td><td><input type="number" class="pop-price" data-idx="3"></td><td><input type="number" value="91" class="pop-storage" data-idx="3" readonly></td><td><input type="number" class="pop-show" data-idx="3"></td></tr>
                        <tr><td>6" Stag</td><td><input type="number" class="pop-price" data-idx="4"></td><td><input type="number" value="132" class="pop-storage" data-idx="4" readonly></td><td><input type="number" class="pop-show" data-idx="4"></td></tr>
                        <tr><td>Grooved</td><td><input type="number" class="pop-price" data-idx="5"></td><td><input type="number" value="17" class="pop-storage" data-idx="5" readonly></td><td><input type="number" class="pop-show" data-idx="5"></td></tr>
                        <tr><td>Folders</td><td><input type="number" class="pop-price" data-idx="6"></td><td><input type="number" value="66" class="pop-storage" data-idx="6" readonly></td><td><input type="number" class="pop-show" data-idx="6"></td></tr>
                        <tr><td>Clipped Folder</td><td><input type="number" class="pop-price" data-idx="7"></td><td><input type="number" value="18" class="pop-storage" data-idx="7" readonly></td><td><input type="number" class="pop-show" data-idx="7"></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Wetumpka Sheet -->
        <div id="wetumpka" class="tab-content">
            <div class="tab-section">
                <h2>Wetumpka, Alabama - December 12-13</h2>
                <div class="sheet-controls">
                    <div class="sheet-status inactive" id="wetumpka-status">‚óè Inactive</div>
                    <button class="nav-link btn-activate" onclick="activateSheet('wetumpka')" id="wet-activate">‚ñ∂Ô∏è Activate</button>
                    <button class="nav-link btn-lock" onclick="openLockModal('wetumpka')" id="wet-lock" style="display:none">üîí Lock Event</button>
                    <button class="nav-link btn-unlock" onclick="unlockSheet('wetumpka')" id="wet-unlock" style="display:none">üîì Unlock</button>
                </div>
                <div id="wet-status"></div>
                <table>
                    <thead><tr><th>Product</th><th>Brought</th><th>Sold</th><th>Left</th></tr></thead>
                    <tbody>
                        <tr><td>Full Tang</td><td><input type="number" class="units-brought" data-sheet="wetumpka" data-idx="0" readonly></td><td><input type="number" class="units-sold" data-sheet="wetumpka" data-idx="0" readonly></td><td><input type="number" class="units-left" data-sheet="wetumpka" data-idx="0"></td></tr>
                        <tr><td>8" Rat</td><td><input type="number" class="units-brought" data-sheet="wetumpka" data-idx="1" readonly></td><td><input type="number" class="units-sold" data-sheet="wetumpka" data-idx="1" readonly></td><td><input type="number" class="units-left" data-sheet="wetumpka" data-idx="1"></td></tr>
                        <tr><td>6" Rat</td><td><input type="number" class="units-brought" data-sheet="wetumpka" data-idx="2" readonly></td><td><input type="number" class="units-sold" data-sheet="wetumpka" data-idx="2" readonly></td><td><input type="number" class="units-left" data-sheet="wetumpka" data-idx="2"></td></tr>
                        <tr><td>8" Stag</td><td><input type="number" class="units-brought" data-sheet="wetumpka" data-idx="3" readonly></td><td><input type="number" class="units-sold" data-sheet="wetumpka" data-idx="3" readonly></td><td><input type="number" class="units-left" data-sheet="wetumpka" data-idx="3"></td></tr>
                        <tr><td>6" Stag</td><td><input type="number" class="units-brought" data-sheet="wetumpka" data-idx="4" readonly></td><td><input type="number" class="units-sold" data-sheet="wetumpka" data-idx="4" readonly></td><td><input type="number" class="units-left" data-sheet="wetumpka" data-idx="4"></td></tr>
                        <tr><td>Grooved</td><td><input type="number" class="units-brought" data-sheet="wetumpka" data-idx="5" readonly></td><td><input type="number" class="units-sold" data-sheet="wetumpka" data-idx="5" readonly></td><td><input type="number" class="units-left" data-sheet="wetumpka" data-idx="5"></td></tr>
                        <tr><td>Folders</td><td><input type="number" class="units-brought" data-sheet="wetumpka" data-idx="6" readonly></td><td><input type="number" class="units-sold" data-sheet="wetumpka" data-idx="6" readonly></td><td><input type="number" class="units-left" data-sheet="wetumpka" data-idx="6"></td></tr>
                        <tr><td>Clipped Folder</td><td><input type="number" class="units-brought" data-sheet="wetumpka" data-idx="7" readonly></td><td><input type="number" class="units-sold" data-sheet="wetumpka" data-idx="7" readonly></td><td><input type="number" class="units-left" data-sheet="wetumpka" data-idx="7"></td></tr>
                        <tr class="units-sold-row"><td colspan="2"><strong>TOTAL UNITS SOLD</strong></td><td colspan="2"><input type="number" id="wet-total-units" readonly></td></tr>
                        <tr class="revenue-row"><td colspan="2"><strong>TOTAL REVENUE</strong></td><td colspan="2"><input type="number" id="wet-total-revenue" readonly></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Trussville Sheet -->
        <div id="trussville" class="tab-content">
            <div class="tab-section">
                <h2>Trussville, Alabama - January 3-4</h2>
                <div class="sheet-controls">
                    <div class="sheet-status inactive" id="trussville-status">‚óè Inactive</div>
                    <button class="nav-link btn-activate" onclick="activateSheet('trussville')" id="trus-activate">‚ñ∂Ô∏è Activate</button>
                    <button class="nav-link btn-lock" onclick="openLockModal('trussville')" id="trus-lock" style="display:none">üîí Lock Event</button>
                    <button class="nav-link btn-unlock" onclick="unlockSheet('trussville')" id="trus-unlock" style="display:none">üîì Unlock</button>
                </div>
                <div id="trus-status"></div>
                <table>
                    <thead><tr><th>Product</th><th>Brought</th><th>Sold</th><th>Left</th></tr></thead>
                    <tbody>
                        <tr><td>Full Tang</td><td><input type="number" class="units-brought" data-sheet="trussville" data-idx="0" readonly></td><td><input type="number" class="units-sold" data-sheet="trussville" data-idx="0" readonly></td><td><input type="number" class="units-left" data-sheet="trussville" data-idx="0"></td></tr>
                        <tr><td>8" Rat</td><td><input type="number" class="units-brought" data-sheet="trussville" data-idx="1" readonly></td><td><input type="number" class="units-sold" data-sheet="trussville" data-idx="1" readonly></td><td><input type="number" class="units-left" data-sheet="trussville" data-idx="1"></td></tr>
                        <tr><td>6" Rat</td><td><input type="number" class="units-brought" data-sheet="trussville" data-idx="2" readonly></td><td><input type="number" class="units-sold" data-sheet="trussville" data-idx="2" readonly></td><td><input type="number" class="units-left" data-sheet="trussville" data-idx="2"></td></tr>
                        <tr><td>8" Stag</td><td><input type="number" class="units-brought" data-sheet="trussville" data-idx="3" readonly></td><td><input type="number" class="units-sold" data-sheet="trussville" data-idx="3" readonly></td><td><input type="number" class="units-left" data-sheet="trussville" data-idx="3"></td></tr>
                        <tr><td>6" Stag</td><td><input type="number" class="units-brought" data-sheet="trussville" data-idx="4" readonly></td><td><input type="number" class="units-sold" data-sheet="trussville" data-idx="4" readonly></td><td><input type="number" class="units-left" data-sheet="trussville" data-idx="4"></td></tr>
                        <tr><td>Grooved</td><td><input type="number" class="units-brought" data-sheet="trussville" data-idx="5" readonly></td><td><input type="number" class="units-sold" data-sheet="trussville" data-idx="5" readonly></td><td><input type="number" class="units-left" data-sheet="trussville" data-idx="5"></td></tr>
                        <tr><td>Folders</td><td><input type="number" class="units-brought" data-sheet="trussville" data-idx="6" readonly></td><td><input type="number" class="units-sold" data-sheet="trussville" data-idx="6" readonly></td><td><input type="number" class="units-left" data-sheet="trussville" data-idx="6"></td></tr>
                        <tr><td>Clipped Folder</td><td><input type="number" class="units-brought" data-sheet="trussville" data-idx="7" readonly></td><td><input type="number" class="units-sold" data-sheet="trussville" data-idx="7" readonly></td><td><input type="number" class="units-left" data-sheet="trussville" data-idx="7"></td></tr>
                        <tr class="units-sold-row"><td colspan="2"><strong>TOTAL UNITS SOLD</strong></td><td colspan="2"><input type="number" id="trus-total-units" readonly></td></tr>
                        <tr class="revenue-row"><td colspan="2"><strong>TOTAL REVENUE</strong></td><td colspan="2"><input type="number" id="trus-total-revenue" readonly></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Columbia Sheet -->
        <div id="columbia" class="tab-content">
            <div class="tab-section">
                <h2>Columbia, Tennessee - January 10-11</h2>
                <div class="sheet-controls">
                    <div class="sheet-status inactive" id="columbia-status">‚óè Inactive</div>
                    <button class="nav-link btn-activate" onclick="activateSheet('columbia')" id="col-activate">‚ñ∂Ô∏è Activate</button>
                    <button class="nav-link btn-lock" onclick="openLockModal('columbia')" id="col-lock" style="display:none">üîí Lock Event</button>
                    <button class="nav-link btn-unlock" onclick="unlockSheet('columbia')" id="col-unlock" style="display:none">üîì Unlock</button>
                </div>
                <div id="col-status"></div>
                <table>
                    <thead><tr><th>Product</th><th>Brought</th><th>Sold</th><th>Left</th></tr></thead>
                    <tbody>
                        <tr><td>Full Tang</td><td><input type="number" class="units-brought" data-sheet="columbia" data-idx="0" readonly></td><td><input type="number" class="units-sold" data-sheet="columbia" data-idx="0" readonly></td><td><input type="number" class="units-left" data-sheet="columbia" data-idx="0"></td></tr>
                        <tr><td>8" Rat</td><td><input type="number" class="units-brought" data-sheet="columbia" data-idx="1" readonly></td><td><input type="number" class="units-sold" data-sheet="columbia" data-idx="1" readonly></td><td><input type="number" class="units-left" data-sheet="columbia" data-idx="1"></td></tr>
                        <tr><td>6" Rat</td><td><input type="number" class="units-brought" data-sheet="columbia" data-idx="2" readonly></td><td><input type="number" class="units-sold" data-sheet="columbia" data-idx="2" readonly></td><td><input type="number" class="units-left" data-sheet="columbia" data-idx="2"></td></tr>
                        <tr><td>8" Stag</td><td><input type="number" class="units-brought" data-sheet="columbia" data-idx="3" readonly></td><td><input type="number" class="units-sold" data-sheet="columbia" data-idx="3" readonly></td><td><input type="number" class="units-left" data-sheet="columbia" data-idx="3"></td></tr>
                        <tr><td>6" Stag</td><td><input type="number" class="units-brought" data-sheet="columbia" data-idx="4" readonly></td><td><input type="number" class="units-sold" data-sheet="columbia" data-idx="4" readonly></td><td><input type="number" class="units-left" data-sheet="columbia" data-idx="4"></td></tr>
                        <tr><td>Grooved</td><td><input type="number" class="units-brought" data-sheet="columbia" data-idx="5" readonly></td><td><input type="number" class="units-sold" data-sheet="columbia" data-idx="5" readonly></td><td><input type="number" class="units-left" data-sheet="columbia" data-idx="5"></td></tr>
                        <tr><td>Folders</td><td><input type="number" class="units-brought" data-sheet="columbia" data-idx="6" readonly></td><td><input type="number" class="units-sold" data-sheet="columbia" data-idx="6" readonly></td><td><input type="number" class="units-left" data-sheet="columbia" data-idx="6"></td></tr>
                        <tr><td>Clipped Folder</td><td><input type="number" class="units-brought" data-sheet="columbia" data-idx="7" readonly></td><td><input type="number" class="units-sold" data-sheet="columbia" data-idx="7" readonly></td><td><input type="number" class="units-left" data-sheet="columbia" data-idx="7"></td></tr>
                        <tr class="units-sold-row"><td colspan="2"><strong>TOTAL UNITS SOLD</strong></td><td colspan="2"><input type="number" id="col-total-units" readonly></td></tr>
                        <tr class="revenue-row"><td colspan="2"><strong>TOTAL REVENUE</strong></td><td colspan="2"><input type="number" id="col-total-revenue" readonly></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Hattiesburg Sheet -->
        <div id="hattiesburg" class="tab-content">
            <div class="tab-section">
                <h2>Hattiesburg, Mississippi - January 17</h2>
                <div class="sheet-controls">
                    <div class="sheet-status inactive" id="hattiesburg-status">‚óè Inactive</div>
                    <button class="nav-link btn-activate" onclick="activateSheet('hattiesburg')" id="hat-activate">‚ñ∂Ô∏è Activate</button>
                    <button class="nav-link btn-lock" onclick="openLockModal('hattiesburg')" id="hat-lock" style="display:none">üîí Lock Event</button>
                    <button class="nav-link btn-unlock" onclick="unlockSheet('hattiesburg')" id="hat-unlock" style="display:none">üîì Unlock</button>
                </div>
                <div id="hat-status"></div>
                <table>
                    <thead><tr><th>Product</th><th>Brought</th><th>Sold</th><th>Left</th></tr></thead>
                    <tbody>
                        <tr><td>Full Tang</td><td><input type="number" class="units-brought" data-sheet="hattiesburg" data-idx="0" readonly></td><td><input type="number" class="units-sold" data-sheet="hattiesburg" data-idx="0" readonly></td><td><input type="number" class="units-left" data-sheet="hattiesburg" data-idx="0"></td></tr>
                        <tr><td>8" Rat</td><td><input type="number" class="units-brought" data-sheet="hattiesburg" data-idx="1" readonly></td><td><input type="number" class="units-sold" data-sheet="hattiesburg" data-idx="1" readonly></td><td><input type="number" class="units-left" data-sheet="hattiesburg" data-idx="1"></td></tr>
                        <tr><td>6" Rat</td><td><input type="number" class="units-brought" data-sheet="hattiesburg" data-idx="2" readonly></td><td><input type="number" class="units-sold" data-sheet="hattiesburg" data-idx="2" readonly></td><td><input type="number" class="units-left" data-sheet="hattiesburg" data-idx="2"></td></tr>
                        <tr><td>8" Stag</td><td><input type="number" class="units-brought" data-sheet="hattiesburg" data-idx="3" readonly></td><td><input type="number" class="units-sold" data-sheet="hattiesburg" data-idx="3" readonly></td><td><input type="number" class="units-left" data-sheet="hattiesburg" data-idx="3"></td></tr>
                        <tr><td>6" Stag</td><td><input type="number" class="units-brought" data-sheet="hattiesburg" data-idx="4" readonly></td><td><input type="number" class="units-sold" data-sheet="hattiesburg" data-idx="4" readonly></td><td><input type="number" class="units-left" data-sheet="hattiesburg" data-idx="4"></td></tr>
                        <tr><td>Grooved</td><td><input type="number" class="units-brought" data-sheet="hattiesburg" data-idx="5" readonly></td><td><input type="number" class="units-sold" data-sheet="hattiesburg" data-idx="5" readonly></td><td><input type="number" class="units-left" data-sheet="hattiesburg" data-idx="5"></td></tr>
                        <tr><td>Folders</td><td><input type="number" class="units-brought" data-sheet="hattiesburg" data-idx="6" readonly></td><td><input type="number" class="units-sold" data-sheet="hattiesburg" data-idx="6" readonly></td><td><input type="number" class="units-left" data-sheet="hattiesburg" data-idx="6"></td></tr>
                        <tr><td>Clipped Folder</td><td><input type="number" class="units-brought" data-sheet="hattiesburg" data-idx="7" readonly></td><td><input type="number" class="units-sold" data-sheet="hattiesburg" data-idx="7" readonly></td><td><input type="number" class="units-left" data-sheet="hattiesburg" data-idx="7"></td></tr>
                        <tr class="units-sold-row"><td colspan="2"><strong>TOTAL UNITS SOLD</strong></td><td colspan="2"><input type="number" id="hat-total-units" readonly></td></tr>
                        <tr class="revenue-row"><td colspan="2"><strong>TOTAL REVENUE</strong></td><td colspan="2"><input type="number" id="hat-total-revenue" readonly></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Lock Modal -->
    <div id="lockModal" class="modal">
        <div class="modal-content">
            <h3>üîí Lock Event & Save to Firebase</h3>
            <div class="modal-info">
                <p>This will calculate totals and permanently save all data to Firebase. You can unlock later if needed.</p>
            </div>
            <div class="modal-totals">
                <table>
                    <tr>
                        <td><strong>Total Units Sold:</strong></td>
                        <td id="modal-total-units">0</td>
                    </tr>
                    <tr>
                        <td><strong>Total Revenue:</strong></td>
                        <td id="modal-total-revenue">$0.00</td>
                    </tr>
                </table>
            </div>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeLockModal()">Cancel</button>
                <button class="btn-confirm" onclick="confirmLock()" style="background: #d32f2f;">Lock & Save</button>
            </div>
        </div>
    </div>

    <script>
        const SHEETS = ['wetumpka', 'trussville', 'columbia', 'hattiesburg'];
        const PRODUCTS = 8;
        let sheetData = {};
        let currentSheet = null;

        // Initialize sheet data
        SHEETS.forEach(sheet => {
            sheetData[sheet] = { active: false, locked: false, data: {} };
        });

        function switchTab(evt, tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            if (evt && evt.target.classList.contains('tab-btn')) {
                evt.target.classList.add('active');
            }
        }

        function activateSheet(sheet) {
            // Deactivate other sheets
            SHEETS.forEach(s => {
                if (s !== sheet) {
                    sheetData[s].active = false;
                    updateSheetUI(s);
                }
            });

            // Activate this sheet
            sheetData[sheet].active = true;
            currentSheet = sheet;

            // Sync show tub to units brought
            for (let i = 0; i < PRODUCTS; i++) {
                const showTubVal = parseFloat(document.querySelector(`.pop-show[data-idx="${i}"]`)?.value || 0);
                const broughtEl = document.querySelector(`.units-brought[data-sheet="${sheet}"][data-idx="${i}"]`);
                if (broughtEl) broughtEl.value = showTubVal;
            }

            updateSheetUI(sheet);
            alert(`‚úÖ ${sheet.toUpperCase()} activated!`);
        }

        function updateSheetUI(sheet) {
            const isLocked = sheetData[sheet].locked;
            const isActive = sheetData[sheet].active && !isLocked;

            const statusEl = document.getElementById(`${sheet.substring(0, 3)}-status`);
            const activateBtn = document.getElementById(`${sheet.substring(0, 3)}-activate`);
            const lockBtn = document.getElementById(`${sheet.substring(0, 3)}-lock`);
            const unlockBtn = document.getElementById(`${sheet.substring(0, 3)}-unlock`);

            if (isLocked) {
                if (statusEl) {
                    statusEl.textContent = 'üîí Locked';
                    statusEl.className = 'sheet-status locked';
                }
                activateBtn.style.display = 'none';
                lockBtn.style.display = 'none';
                unlockBtn.style.display = 'inline-block';
            } else if (isActive) {
                if (statusEl) {
                    statusEl.textContent = '‚óè Active';
                    statusEl.className = 'sheet-status active';
                }
                activateBtn.style.display = 'none';
                lockBtn.style.display = 'inline-block';
                unlockBtn.style.display = 'none';
            } else {
                if (statusEl) {
                    statusEl.textContent = '‚óè Inactive';
                    statusEl.className = 'sheet-status inactive';
                }
                activateBtn.style.display = 'inline-block';
                lockBtn.style.display = 'none';
                unlockBtn.style.display = 'none';
            }
        }

        function openLockModal(sheet) {
            currentSheet = sheet;

            // Calculate totals
            let totalUnits = 0;
            let totalRevenue = 0;

            for (let i = 0; i < PRODUCTS; i++) {
                const broughtEl = document.querySelector(`.units-brought[data-sheet="${sheet}"][data-idx="${i}"]`);
                const leftEl = document.querySelector(`.units-left[data-sheet="${sheet}"][data-idx="${i}"]`);
                const priceEl = document.querySelector(`.pop-price[data-idx="${i}"]`);

                const brought = parseFloat(broughtEl?.value || 0);
                const left = parseFloat(leftEl?.value || 0);
                const price = parseFloat(priceEl?.value || 0);

                const sold = Math.max(0, brought - left);
                totalUnits += sold;
                totalRevenue += sold * price;

                // Update sold display
                const soldEl = document.querySelector(`.units-sold[data-sheet="${sheet}"][data-idx="${i}"]`);
                if (soldEl) soldEl.value = sold;
            }

            // Show in modal
            document.getElementById('modal-total-units').textContent = totalUnits;
            document.getElementById('modal-total-revenue').textContent = '$' + totalRevenue.toFixed(2);

            document.getElementById('lockModal').classList.add('active');
        }

        function closeLockModal() {
            document.getElementById('lockModal').classList.remove('active');
        }

        function confirmLock() {
            if (!currentSheet) return;

            const sheet = currentSheet;
            let totalUnits = 0;
            let totalRevenue = 0;

            // Build data object
            const fbData = { locked: true, timestamp: new Date().toISOString() };

            for (let i = 0; i < PRODUCTS; i++) {
                const broughtEl = document.querySelector(`.units-brought[data-sheet="${sheet}"][data-idx="${i}"]`);
                const leftEl = document.querySelector(`.units-left[data-sheet="${sheet}"][data-idx="${i}"]`);
                const priceEl = document.querySelector(`.pop-price[data-idx="${i}"]`);

                const brought = parseFloat(broughtEl?.value || 0);
                const left = parseFloat(leftEl?.value || 0);
                const price = parseFloat(priceEl?.value || 0);

                const sold = Math.max(0, brought - left);

                fbData[`product_${i}`] = {
                    brought: brought,
                    left: left,
                    sold: sold,
                    price: price
                };

                totalUnits += sold;
                totalRevenue += sold * price;
            }

            // Add totals
            fbData.totalUnits = totalUnits;
            fbData.totalRevenue = totalRevenue.toFixed(2);

            // Save to Firebase
            const sheetRef = window.firebaseRef(window.firebaseDB, `salesSheets/${sheet}`);

            window.firebaseSet(sheetRef, fbData)
                .then(() => {
                    console.log(`‚úÖ Sheet ${sheet} saved to Firebase`);

                    // Update local state
                    sheetData[sheet].locked = true;
                    sheetData[sheet].active = false;

                    // Update UI
                    updateSheetUI(sheet);

                    // Update totals display
                    document.getElementById(`${sheet.substring(0, 3)}-total-units`).value = totalUnits;
                    document.getElementById(`${sheet.substring(0, 3)}-total-revenue`).value = totalRevenue.toFixed(2);

                    // Show status
                    const statusDiv = document.getElementById(`${sheet.substring(0, 3)}-status`);
                    if (statusDiv) {
                        const parent = statusDiv.parentElement;
                        const existingStatus = parent.querySelector('.status-box');
                        if (existingStatus) existingStatus.remove();

                        const newStatus = document.createElement('div');
                        newStatus.className = 'status-box status-success';
                        newStatus.innerHTML = `‚úÖ <strong>LOCKED & SAVED!</strong><br>Units: ${totalUnits} | Revenue: $${totalRevenue.toFixed(2)}<br>Saved at: ${new Date().toLocaleTimeString()}`;
                        parent.insertBefore(newStatus, statusDiv.nextSibling);
                    }

                    closeLockModal();
                    alert(`‚úÖ SUCCESS!\n\n${sheet.toUpperCase()} is now LOCKED\nUnits Sold: ${totalUnits}\nTotal Revenue: $${totalRevenue.toFixed(2)}\n\nData is saved to Firebase. You can safely refresh your browser!`);
                })
                .catch(error => {
                    console.error('Firebase error:', error);
                    alert(`‚ùå Error saving to Firebase:\n${error.message}`);
                });
        }

        function unlockSheet(sheet) {
            if (!confirm(`Unlock ${sheet.toUpperCase()}? This will allow you to edit it again.`)) return;

            const sheetRef = window.firebaseRef(window.firebaseDB, `salesSheets/${sheet}`);

            window.firebaseSet(sheetRef, { locked: false })
                .then(() => {
                    console.log(`‚úÖ Sheet ${sheet} unlocked`);

                    sheetData[sheet].locked = false;
                    updateSheetUI(sheet);

                    // Clear status
                    const statusDiv = document.getElementById(`${sheet.substring(0, 3)}-status`);
                    if (statusDiv && statusDiv.parentElement) {
                        const existingStatus = statusDiv.parentElement.querySelector('.status-box');
                        if (existingStatus) existingStatus.remove();
                    }

                    alert(`‚úÖ ${sheet.toUpperCase()} unlocked!`);
                })
                .catch(error => {
                    alert(`‚ùå Error:\n${error.message}`);
                });
        }

        // Load data from Firebase on page load
        function loadDataFromFirebase() {
            SHEETS.forEach(sheet => {
                const sheetRef = window.firebaseRef(window.firebaseDB, `salesSheets/${sheet}`);

                window.firebaseOnValue(sheetRef, (snapshot) => {
                    const fbData = snapshot.val();

                    if (!fbData) return;

                    console.log(`Loaded ${sheet}:`, fbData);

                    if (fbData.locked === true) {
                        sheetData[sheet].locked = true;

                        // Load all product data
                        for (let i = 0; i < PRODUCTS; i++) {
                            const prod = fbData[`product_${i}`];
                            if (prod) {
                                const broughtEl = document.querySelector(`.units-brought[data-sheet="${sheet}"][data-idx="${i}"]`);
                                const leftEl = document.querySelector(`.units-left[data-sheet="${sheet}"][data-idx="${i}"]`);
                                const soldEl = document.querySelector(`.units-sold[data-sheet="${sheet}"][data-idx="${i}"]`);

                                if (broughtEl) broughtEl.value = prod.brought || 0;
                                if (leftEl) leftEl.value = prod.left || 0;
                                if (soldEl) soldEl.value = prod.sold || 0;
                            }
                        }

                        // CRITICAL: Load totals
                        const shortName = sheet.substring(0, 3);
                        const totalUnitsEl = document.getElementById(`${shortName}-total-units`);
                        const totalRevenueEl = document.getElementById(`${shortName}-total-revenue`);

                        if (totalUnitsEl && fbData.totalUnits !== undefined) {
                            totalUnitsEl.value = fbData.totalUnits;
                        }

                        if (totalRevenueEl && fbData.totalRevenue !== undefined) {
                            totalRevenueEl.value = fbData.totalRevenue;
                        }

                        // Show locked status
                        updateSheetUI(sheet);

                        const statusDiv = document.getElementById(`${shortName}-status`);
                        if (statusDiv && statusDiv.parentElement) {
                            const newStatus = document.createElement('div');
                            newStatus.className = 'status-box status-success';
                            newStatus.innerHTML = `üîí Loaded from Firebase - LOCKED<br>Units: ${fbData.totalUnits || 0} | Revenue: $${fbData.totalRevenue || '0.00'}`;
                            const parent = statusDiv.parentElement;
                            const existingStatus = parent.querySelector('.status-box');
                            if (existingStatus) existingStatus.remove();
                            parent.insertBefore(newStatus, statusDiv.nextSibling);
                        }
                    }
                });
            });
        }

        // Calculate units sold on input change
        document.addEventListener('input', (e) => {
            if (e.target.classList.contains('units-left') && currentSheet) {
                const sheet = e.target.dataset.sheet;
                const idx = e.target.dataset.idx;

                const broughtEl = document.querySelector(`.units-brought[data-sheet="${sheet}"][data-idx="${idx}"]`);
                const leftVal = parseFloat(e.target.value || 0);
                const brought = parseFloat(broughtEl?.value || 0);
                const sold = Math.max(0, brought - leftVal);

                const soldEl = document.querySelector(`.units-sold[data-sheet="${sheet}"][data-idx="${idx}"]`);
                if (soldEl) soldEl.value = sold;
            }
        });

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadDataFromFirebase();
        });
    </script>
</body>
</html>
